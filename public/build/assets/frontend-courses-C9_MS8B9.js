document.addEventListener("DOMContentLoaded",function(){const f=document.getElementById("filterForm"),m=document.getElementById("mobileFilterForm"),p=document.getElementById("coursesWrapper"),l=document.getElementById("coursesContainer");let c=1,u=!1,a=!0;h();function h(){E(),L(),b()}function E(){const e=[f,m].filter(n=>n);e.forEach(n=>{n.addEventListener("submit",function(t){t.preventDefault(),c=1,a=!0,d(new FormData(this),!0)}),n.querySelectorAll("select.filter-input").forEach(t=>{t.addEventListener("change",function(){c=1,a=!0,d(new FormData(n),!0)})});const r=n.querySelector('[name="keyword"]');if(r){let t;r.addEventListener("input",function(){clearTimeout(t),t=setTimeout(()=>{c=1,a=!0,d(new FormData(n),!0)},600)})}}),document.querySelectorAll('[id^="resetBtn"], .btn-filter-reset').forEach(n=>{n.addEventListener("click",function(o){o.preventDefault(),e.forEach(r=>r&&r.reset()),c=1,a=!0,d(new FormData,!0)})})}function L(){const e=new IntersectionObserver(o=>{o.forEach(r=>{r.isIntersecting&&!u&&a&&(c++,d(null,!1))})},{rootMargin:"100px"}),n=document.createElement("div");n.id="scroll-trigger",n.style.height="1px",p.appendChild(n),e.observe(n)}function b(){const e=document.querySelector(".btn-mobile-filter");e&&e.addEventListener("click",function(){this.classList.toggle("active")})}function y(e){[f,m].filter(o=>o).forEach(o=>{o.querySelectorAll("input, select, button").forEach(t=>{t.disabled=e,e?(t.style.opacity="0.6",t.style.cursor="not-allowed"):(t.style.opacity="",t.style.cursor="")})})}function d(e=null,n=!0){if(u)return;if(u=!0,y(!0),!e){const s=f||m;e=s?new FormData(s):new FormData}Object.fromEntries(e);const o=new URLSearchParams(e);o.set("page",c);const t=`${(f||m).getAttribute("data-url")}?${o.toString()}`;n?w():k(),fetch(t,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(s=>s.json()).then(s=>{if(n?v(s.html,!0):v(s.html,!1),a=s.hasMore,n){const i=t.replace("&page=1","").replace("page=1&","").replace("?page=1","");window.history.pushState({},"",i||t)}u=!1,y(!1)}).catch(s=>{console.error("Error:",s),g(),u=!1,y(!1)})}function v(e,n){const o=document.createElement("div");o.innerHTML=e;const r=o.querySelector(".row.g-4");if(n)l.style.opacity="0",l.style.transition="opacity 0.3s",setTimeout(()=>{const t=l.querySelector(".row.g-4");t&&r&&(t.innerHTML=r.innerHTML);const s=o.querySelector(".result-info"),i=l.querySelector(".result-info");s&&i?i.outerHTML=s.outerHTML:s&&l.insertBefore(s,l.firstChild),l.style.opacity="1",g(),p.scrollIntoView({behavior:"smooth",block:"start"})},300);else{const t=l.querySelector(".row.g-4");t&&r&&r.querySelectorAll(".col-lg-4").forEach((i,S)=>{i.style.opacity="0",i.style.transform="translateY(20px)",t.appendChild(i),setTimeout(()=>{i.style.transition="all 0.5s ease",i.style.opacity="1",i.style.transform="translateY(0)"},100+S*50)}),g()}}function w(){const e=l.querySelector(".row.g-4");e&&(e.innerHTML=Array(6).fill(0).map(()=>`
                <div class="col-lg-4 col-md-6">
                    <div class="course-card-skeleton">
                        <div class="skeleton skeleton-img"></div>
                        <div class="skeleton-body">
                            <div class="skeleton skeleton-badge"></div>
                            <div class="skeleton skeleton-title"></div>
                            <div class="skeleton skeleton-text"></div>
                            <div class="skeleton skeleton-text"></div>
                            <div class="skeleton skeleton-button"></div>
                        </div>
                    </div>
                </div>
            `).join(""))}function k(){let e=document.getElementById("load-more-spinner");e||(e=document.createElement("div"),e.id="load-more-spinner",e.className="text-center py-4",e.innerHTML=`
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">Loading more courses...</p>
            `,p.appendChild(e))}function g(){const e=document.getElementById("load-more-spinner");e&&e.remove()}});
