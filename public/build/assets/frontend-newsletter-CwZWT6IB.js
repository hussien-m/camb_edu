const c=document.getElementById("newsletter-form");c&&c.addEventListener("submit",async function(i){i.preventDefault();const a=this,r=document.getElementById("newsletter-email").value,e=document.getElementById("newsletter-message"),n=a.querySelector('button[type="submit"]');if(!r||!r.includes("@")){e.className="text-danger",e.textContent="Please enter a valid email address.";return}n.disabled=!0,n.innerHTML='<i class="fas fa-spinner fa-spin"></i> Verifying...';try{let t=null;if(typeof executeRecaptcha=="function")try{t=await executeRecaptcha("newsletter_subscribe")}catch{console.warn("reCAPTCHA not available, continuing without it")}const o={email:r,website_url:"",phone_number_confirm:""};t&&(o.recaptcha_token=t);const s=await fetch(a.getAttribute("data-action"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(o)}),l=await s.json();e.className=s.ok?"text-success":"text-danger",e.textContent=l.message||"An error occurred. Please try again.",s.ok&&a.reset()}catch(t){console.error("Newsletter error:",t),e.className="text-danger",e.textContent="An error occurred. Please try again."}finally{n.disabled=!1,n.innerHTML='<i class="fas fa-paper-plane"></i>',setTimeout(()=>{e.textContent=""},5e3)}});
